<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Radiocosmo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    @import url('https://fonts.googleapis.com/css2?family=Spectral&display=swap');
</style>
<link rel="stylesheet" href="homepage.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://unpkg.com/wavesurfer.js@7"></script>
</head>
<body>
<canvas id="stars"></canvas>

<div class="banner">
    <a href="https://forms.gle/92pu8sH3cgkqg9su6" target="_blank">Subscribe</a>
</div>

<div class="waveform-container">
    <div id="waveform"></div>
    <div class="track-info">
        <span id="current-time">0:00</span>
        <span id="duration">0:00</span>
    </div>
</div>

<div class="main">
    <div class="player">
<div class="now-playing" id="title">Select a track</div>
<button class="play-btn" onclick="play()" id="btn">
<i class="fas fa-play"></i>
</button>
    </div>
    
    <div class="playlist" id="list"></div>
</div>

<script>
const songs = [
{ title: "Waves", date: "24-10-25", url: "https://raw.githubusercontent.com/thisisradiocosmo/radiocosmo/test-waveform-player/songs/waves-master.mp3" },
{ title: "Sunday Loop", date: "???", url: "https://raw.githubusercontent.com/thisisradiocosmo/radiocosmo/test-waveform-player/songs/sunday-loop.mp3" }
];

let i = 0, playing = false;
let wavesurfer;

// Initialize WaveSurfer
wavesurfer = WaveSurfer.create({
    container: '#waveform',
    waveColor: '#4a90e2',
    progressColor: '#ffffff',
    cursorColor: '#ffffff',
    barWidth: 2,
    barRadius: 3,
    cursorWidth: 1,
    height: 80,
    barGap: 2,
    responsive: true
});

// Update time display
wavesurfer.on('audioprocess', () => {
    document.getElementById('current-time').textContent = formatTime(wavesurfer.getCurrentTime());
});

wavesurfer.on('ready', () => {
    document.getElementById('duration').textContent = formatTime(wavesurfer.getDuration());
});

wavesurfer.on('finish', () => {
    playing = true; 
    i = (i + 1) % songs.length;
    load(i);
});

wavesurfer.on('play', () => {
    playing = true;
    btn.innerHTML = '<i class="fas fa-pause"></i>';
});

wavesurfer.on('pause', () => {
    playing = false;
    btn.innerHTML = '<i class="fas fa-play"></i>';
});

function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs.toString().padStart(2, '0')}`;
}

// Playlist
songs.forEach((s, x) => {
    const el = document.createElement('div');
    el.className = 'song';
    el.innerHTML = `<span class="song-title">${s.title}</span><span class="song-date">${s.date}</span>`;
    el.onclick = () => load(x);
    list.appendChild(el);
});

function load(x) {
    i = x;
    wavesurfer.load(songs[i].url);
    title.textContent = songs[i].title;
    document.querySelectorAll('.song').forEach((el, idx) => el.classList.toggle('active', idx === i));
    
    // If we should be playing, wait for the audio to be ready then play
    if (playing) {
        wavesurfer.once('ready', () => {
            wavesurfer.play();
        });
    }
}

function play() {
    if (!wavesurfer.getDuration()) {
        // If no audio loaded yet, load first song
        load(0);
        playing = true; // Set state before loading
        return;
    }
    
    wavesurfer.playPause();
}

load(0);

// Stars
const canvas = document.getElementById('stars');
const ctx = canvas.getContext('2d');
let w, h, stars = [];

function resize() {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
    stars = Array.from({ length: 60 }, () => ({
        x: Math.random() * w,
        y: Math.random() * h,
        r: Math.random() * 1.2 + 0.2,
        alpha: Math.random() * 0.3,
        dAlpha: (Math.random() * 0.01 + 0.003) * (Math.random() < 0.5 ? 1 : -1)
    }));
}

function draw() {
    ctx.clearRect(0, 0, w, h);
    ctx.fillStyle = 'white';
    for (let s of stars) {
        s.alpha += s.dAlpha;
        if (s.alpha <= 0 || s.alpha >= 0.3) s.dAlpha *= -1;
        ctx.globalAlpha = s.alpha;
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
        ctx.fill();
    }
    ctx.globalAlpha = 1;
    requestAnimationFrame(draw);
}

window.addEventListener('resize', resize);
resize();
draw();
</script>
</body>

</html>
